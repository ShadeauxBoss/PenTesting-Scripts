#!/bin/bash

#if [ "$1" =="" ]; then 
#	echo "Script Execution requires Domain or IP...It is blank. Example: URL.com or 0.0.0.0"
#	return
#else echo "Scanning Domain Now..."
#fi

url=$1

if [ ! -d "$url" ]; then 
	mkdir $url
fi

if [ ! -d "$url/recon" ]; then
	mkdir $url/recon
fi

if [ ! -d "$url/recon/potential_takeovers" ];then
	mkdir $url/recon/potential_takeovers
fi

if [ ! -d "$url/recon/scans" ];then
	mkdir $url/recon/nampscans
fi

echo "[+] Harvesting subdomains with AssetFinder..."
assetfinder $url >> $url/recon/assetraw.txt
cat $url/recon/assetraw.txt | grep $1 >> $url/recon/subsonly.txt

#echo "[+] Double-Cheking subdomains with Amass..."
#amass enum -d $url >> $url/recon/amassraw.txt
#sort -u $url/recon/amassraw.txt >> $url/recon/subsonly.txt

echo "[+] Checking for possible subdomain takeover..."

if [ ! -f "$url/recon/potential_takeovers/potential_takeovers.txt" ];then
	touch $url/recon/potential_takeovers/potential_takeovers.txt
fi

subjack -w $url/recon/subsonly.txt -t 100 -timeout 30 -ssl -c ~/go/src/github.com/haccer/subjack/fingerprints.json -v 3 -o $url/recon/potential_takeovers/potential_takeovers.txt


echo "[+] Probing for live domains with Httprobe..."
cat $url/recon/subsonly.txt | sort -u | httprobe -s -p https:443 | sed 's/https\?:\/\///' | tr -d ':443'  >> $url/recon/httprobe/livesubsonly.txt

echo "[+] Scanning for open ports..."
nmap -iL $url/recon/httprobe/livesubsonly.txt -T4 -A -p- -oA $url/recon/nmapscan/scanned.txt
